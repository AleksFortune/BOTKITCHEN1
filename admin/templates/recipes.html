{% extends "base.html" %}

{% block title %}–†–µ—Ü–µ–ø—Ç—ã - MealBot Admin{% endblock %}

{% block content %}
<div class="admin-layout">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>üçΩÔ∏è <span>MealBot</span></h2>
        </div>
        <nav class="sidebar-nav">
            <a href="/admin" class="nav-item">
                <i class="fas fa-home nav-icon"></i>
                Dashboard
            </a>
            <a href="/admin/users" class="nav-item">
                <i class="fas fa-users nav-icon"></i>
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </a>
            <a href="/admin/recipes" class="nav-item active">
                <i class="fas fa-utensils nav-icon"></i>
                –†–µ—Ü–µ–ø—Ç—ã
            </a>
            <div style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                <a href="/admin/logout" class="nav-item" style="color: var(--danger);">
                    <i class="fas fa-sign-out-alt nav-icon"></i>
                    –í—ã—Ö–æ–¥
                </a>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="top-bar">
            <h1>–†–µ—Ü–µ–ø—Ç—ã</h1>
            <div class="user-menu">
                <a href="/admin/recipes/new" class="btn btn-success">
                    <i class="fas fa-plus"></i>
                    –ù–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç
                </a>
                <span style="color: var(--secondary);">{{ admin }}</span>
                <div style="width: 32px; height: 32px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                    {{ admin[0].upper() }}
                </div>
            </div>
        </div>

        {% if request.query_params.success == 'recipe_deleted' %}
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            –†–µ—Ü–µ–ø—Ç —É–¥–∞–ª—ë–Ω
        </div>
        {% endif %}

        <!-- Stats -->
        <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="stat-card">
                <div class="stat-label">–í—Å–µ–≥–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤</div>
                <div class="stat-value">{{ stats.total }}</div>
            </div>
            {% for meal, count in stats.by_meal_type.items() %}
            <div class="stat-card {% if meal == 'breakfast' %}info{% elif meal == 'lunch' %}success{% elif meal == 'dinner' %}warning{% else %}secondary{% endif %}">
                <div class="stat-label" style="text-transform: capitalize;">{{ meal }}</div>
                <div class="stat-value">{{ count }}</div>
            </div>
            {% endfor %}
        </div>

        <!-- Filters -->
        <div class="card">
            <form method="GET" action="/admin/recipes" class="search-filters">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." value="{{ search or '' }}">
                </div>

                <select name="day" class="form-select" style="width: auto;">
                    <option value="">–í—Å–µ –¥–Ω–∏</option>
                    {% for d in range(1, 31) %}
                    <option value="{{ d }}" {% if day_filter == d %}selected{% endif %}>–î–µ–Ω—å {{ d }}</option>
                    {% endfor %}
                </select>

                <select name="meal_type" class="form-select" style="width: auto;">
                    <option value="">–í—Å–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏</option>
                    {% for mt in meal_types %}
                    <option value="{{ mt }}" {% if meal_type_filter == mt %}selected{% endif %} style="text-transform: capitalize;">{{ mt }}</option>
                    {% endfor %}
                </select>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-filter"></i>
                    –§–∏–ª—å—Ç—Ä
                </button>

                {% if search or day_filter or meal_type_filter %}
                <a href="/admin/recipes" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    –°–±—Ä–æ—Å
                </a>
                {% endif %}
            </form>
        </div>

        <!-- Recipes Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
            {% for recipe in recipes %}
            <div class="card" style="display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                    <div>
                        <span class="badge {% if recipe.is_premium %}badge-success{% else %}badge-secondary{% endif %}" style="margin-bottom: 0.5rem; display: inline-block;">
                            {% if recipe.is_premium %}üíé –ü—Ä–µ–º–∏—É–º{% else %}üÜì Free{% endif %}
                        </span>
                        <div style="font-size: 0.875rem; color: var(--secondary);">
                            –î–µ–Ω—å {{ recipe.day_number }} ‚Ä¢ <span style="text-transform: capitalize;">{{ recipe.meal_type }}</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">{{ recipe.calories_value }}</div>
                        <div style="font-size: 0.75rem; color: var(--secondary);">–∫–∫–∞–ª</div>
                    </div>
                </div>

                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4;">
                    {{ recipe.title.split(':')[-1] if ':' in recipe.title else recipe.title }}
                </h3>

                <p style="font-size: 0.875rem; color: var(--secondary); margin-bottom: 1rem; flex: 1;">
                    {{ recipe.shopping_preview }}
                </p>

                {% if recipe.tags %}
                <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-bottom: 1rem;">
                    {% for tag in recipe.tags[:5] %}
                    <span class="badge badge-info" style="font-size: 0.7rem;">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                <div style="display: flex; gap: 0.5rem;">
                    <a href="/admin/recipes/{{ recipe.id }}" class="btn btn-primary btn-sm" style="flex: 1;">
                        <i class="fas fa-eye"></i>
                        –ü—Ä–æ—Å–º–æ—Ç—Ä
                    </a>
                    <form method="POST" action="/admin/recipes/{{ recipe.id }}/delete" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç?');">
                        <button type="submit" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if not recipes %}
        <div class="card" style="text-align: center; padding: 3rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üçΩÔ∏è</div>
            <h3 style="margin-bottom: 0.5rem;">–†–µ—Ü–µ–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p style="color: var(--secondary);">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç</p>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}